<div>
	<nz-breadcrumb class="font-bold text-sm" [nzAutoGenerate]="true"></nz-breadcrumb>
</div>

<div class="my-2">
	<!-- Header con icono -->
	<div class="flex items-center gap-2 mb-6">
		<i nz-icon nzType="database" nzTheme="outline" class="text-2xl text-blue-600"></i>
		<div>
			<h1 class="text-xl font-medium text-gray-900 m-0">Control de Inventario</h1>
			<p class="text-gray-500 text-sm m-0">Registro de movimientos de stock</p>
		</div>
	</div>

	<!-- Loading -->
	@if (isLoading) {
		<nz-spin nzTip="Cargando..."></nz-spin>
	}

	<!-- Form Container -->
	@if (!isLoading) {
		<div class="bg-white border border-gray-200 rounded-lg">
			<form [formGroup]="inventarioForm" (ngSubmit)="onSubmit()" class="p-6">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					<!-- Producto Select -->
					<div class="col-span-2">
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="shopping" nzTheme="outline"></i>
							Producto
						</label>
						<nz-select formControlName="id_producto" class="w-full" nzShowSearch nzPlaceHolder="Seleccione un producto">
							@for (producto of productos; track producto.id_producto) {
								<nz-option
									[nzValue]="producto.id_producto"
									[nzLabel]="producto.nombre_producto + ' - Stock: ' + producto.stock"
								>
								</nz-option>
							}
						</nz-select>
						@if (getProductInventarioForm()?.invalid && getProductInventarioForm()?.touched) {
							<small class="text-red-500">
								<i nz-icon nzType="warning" nzTheme="outline"></i> Seleccione un producto
							</small>
						}
					</div>

					<!-- Sucursal Select -->
					<div class="col-span-2">
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="shop" nzTheme="outline"></i>
							Sucursal
						</label>
						<nz-select
							formControlName="id_sucursal"
							class="w-full"
							nzShowSearch
							nzPlaceHolder="Seleccione una sucursal"
						>
							@for (sucursal of sucursales; track sucursal.id_sucursal) {
								<nz-option [nzValue]="sucursal.id_sucursal" [nzLabel]="sucursal.nombre_sucursal"> </nz-option>
							}
						</nz-select>
						@if (getSucursalInventarioForm()?.invalid && getSucursalInventarioForm()?.touched) {
							<small class="text-red-500">
								<i nz-icon nzType="warning" nzTheme="outline"></i> Seleccione una sucursal
							</small>
						}
					</div>

					<!-- Tipo de Movimiento -->
					<div>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="interaction" nzTheme="outline"></i>
							Tipo de Movimiento
						</label>
						<nz-select formControlName="tipo_movimiento" class="w-full">
							<nz-option nzValue="ENTRADA" nzLabel="Entrada"></nz-option>
							<nz-option nzValue="SALIDA" nzLabel="Salida"></nz-option>
						</nz-select>
					</div>

					<!-- Fecha -->
					<div>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="calendar" nzTheme="outline"></i>
							Fecha
						</label>
						<nz-date-picker formControlName="fecha_creacion" class="w-full" [nzShowTime]="true"></nz-date-picker>
					</div>

					<!-- Cantidades Grid -->
					<div class="col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
						<!-- Cantidad -->
						<div>
							<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
								<i nz-icon nzType="number" nzTheme="outline"></i>
								Cantidad
							</label>
							<nz-input-number
								formControlName="cantidad"
								[nzMin]="1"
								class="w-full"
								[nzPlaceHolder]="'Ingrese cantidad'"
							>
							</nz-input-number>
						</div>

						<!-- Stock Anterior -->
						<div>
							<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
								<i nz-icon nzType="stock" nzTheme="outline"></i>
								Stock Anterior
							</label>
							<nz-input-number formControlName="stock_anterior" class="w-full" [nzDisabled]="true"> </nz-input-number>
						</div>

						<!-- Stock Nuevo -->
						<div>
							<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
								<i nz-icon nzType="rise" nzTheme="outline"></i>
								Stock Nuevo
							</label>
							<nz-input-number formControlName="stock_nuevo" class="w-full" [nzDisabled]="true"> </nz-input-number>
						</div>
					</div>

					<!-- Comentarios -->
					<div class="col-span-2">
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="file-text" nzTheme="outline"></i>
							Comentarios
						</label>
						<nz-textarea-count [nzMaxCharacterCount]="500">
							<textarea
								rows="3"
								formControlName="comentarios"
								nz-input
								placeholder="Ingrese comentarios detallados del movimiento"
							>
							</textarea>
						</nz-textarea-count>
					</div>
				</div>

				<!-- Actions -->
				<div class="flex justify-end gap-3 mt-6 pt-4 border-t">
					<button nz-button type="button" (click)="inventarioForm.reset()">
						<i nz-icon nzType="close" nzTheme="outline"></i>
						Cancelar
					</button>
					<button nz-button nzType="primary" type="submit" [disabled]="inventarioForm.invalid">
						<i nz-icon nzType="save" nzTheme="outline"></i>
						Guardar Registro
					</button>
				</div>
			</form>
		</div>
	}
</div>
