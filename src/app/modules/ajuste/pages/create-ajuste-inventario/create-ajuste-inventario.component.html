<div>
	<nz-breadcrumb class="font-bold text-sm" [nzAutoGenerate]="true"> </nz-breadcrumb>
</div>

<div class="my-2">
	<!-- Header con icono -->
	<div class="flex items-center gap-2 mb-6">
		<i nz-icon nzType="inbox" nzTheme="outline" class="text-2xl text-blue-600"></i>
		<div>
			<h1 class="text-xl font-medium text-gray-900 m-0">Ajuste de Inventario</h1>
			<p class="text-gray-500 text-sm m-0">Gestión de stock de productos</p>
		</div>
	</div>

	<!-- Loading -->
	<nz-spin *ngIf="isLoading" nzTip="Cargando..."></nz-spin>

	<!-- Form Container -->
	<div *ngIf="!isLoading" class="bg-white border border-gray-200 rounded-lg">
		<form [formGroup]="ajusteForm" (ngSubmit)="onSubmit()" class="p-6">
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<!-- Producto Select con búsqueda -->
				<div class="col-span-2">
					<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
						<i nz-icon nzType="shopping" nzTheme="outline"></i>
						Producto
					</label>
					<nz-select formControlName="id_producto" class="w-full" nzShowSearch nzPlaceHolder="Seleccione un producto">
						<nz-option
							*ngFor="let producto of productos"
							[nzValue]="producto.id_producto"
							[nzLabel]="producto.nombre_producto + ' - Stock: ' + producto.stock"
						></nz-option>
					</nz-select>
					<small *ngIf="getProductoAjusteForm()?.invalid && getProductoAjusteForm()?.touched" class="text-red-500">
						<i nz-icon nzType="warning" nzTheme="outline"></i> Seleccione un producto
					</small>
				</div>

				<!-- Tipo de Ajuste -->
				<div>
					<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
						<i nz-icon nzType="interaction" nzTheme="outline"></i>
						Tipo de Ajuste
					</label>
					<nz-select formControlName="tipo_ajuste" class="w-full">
						<nz-option nzValue="INCREMENTO" nzLabel="Incremento"></nz-option>
						<nz-option nzValue="DISMINUCION" nzLabel="Disminución"></nz-option>
					</nz-select>
				</div>

				<!-- Razón de Ajuste -->
				<div>
					<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
						<i nz-icon nzType="form" nzTheme="outline"></i>
						Razón de Ajuste
					</label>
					<nz-input-group [nzPrefix]="prefixTemplate">
						<input nz-input formControlName="razon_ajuste" placeholder="Ej: Inventario físico" />
					</nz-input-group>
					<ng-template #prefixTemplate>
						<i nz-icon nzType="edit"></i>
					</ng-template>
				</div>

				<!-- Cantidades Grid -->
				<div class="col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
					<!-- Cantidad Ajuste -->
					<div>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="number" nzTheme="outline"></i>
							Cantidad
						</label>
						<nz-input-number
							formControlName="cantidad_ajuste"
							[nzMin]="0"
							class="w-full"
							[nzPlaceHolder]="'Ingrese cantidad'"
						></nz-input-number>
					</div>

					<!-- Stock Anterior -->
					<div>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="stock" nzTheme="outline"></i>
							Stock Anterior
						</label>
						<nz-input-number formControlName="stock_anterior" class="w-full" [nzDisabled]="true"></nz-input-number>
					</div>

					<!-- Stock Nuevo -->
					<div>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
							<i nz-icon nzType="rise" nzTheme="outline"></i>
							Stock Nuevo
						</label>
						<nz-input-number formControlName="stock_nuevo" class="w-full" [nzDisabled]="true"></nz-input-number>
					</div>
				</div>

				<!-- Fecha -->
				<div>
					<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
						<i nz-icon nzType="calendar" nzTheme="outline"></i>
						Fecha de Ajuste
					</label>
					<nz-date-picker formControlName="fecha_ajuste" class="w-full" [nzShowTime]="true"></nz-date-picker>
				</div>

				<!-- Nota -->
				<div class="col-span-2">
					<label class="text-sm font-medium text-gray-700 flex items-center gap-1">
						<i nz-icon nzType="file-text" nzTheme="outline"></i>
						Nota
					</label>
					<nz-textarea-count [nzMaxCharacterCount]="500">
						<textarea
							rows="3"
							formControlName="nota"
							nz-input
							placeholder="Ingrese una nota detallada del ajuste"
						></textarea>
					</nz-textarea-count>
				</div>
				<!-- Estado Switch -->
				<div class="col-span-2">
					<nz-form-item>
						<label class="text-sm font-medium text-gray-700 flex items-center gap-3">
							<nz-switch
								formControlName="estado"
								[nzCheckedChildren]="checkedTemplate"
								[nzUnCheckedChildren]="unCheckedTemplate"
								[nzLoading]="isLoading"
							></nz-switch>
							<span class="flex items-center gap-2">
								<i
									nz-icon
									[nzType]="getEstadoAjusteForm()?.value ? 'check-circle' : 'close-circle'"
									[class]="getEstadoAjusteForm()?.value ? 'text-green-500' : 'text-red-500'"
								>
								</i>
								<span [class]="getEstadoAjusteForm()?.value ? 'text-green-600' : 'text-red-600'">
									{{ getEstadoAjusteForm()?.value ? 'Activo' : 'Inactivo' }}
								</span>
							</span>
						</label>
					</nz-form-item>
				</div>

				<ng-template #checkedTemplate>
					<i nz-icon nzType="check"></i>
				</ng-template>

				<ng-template #unCheckedTemplate>
					<i nz-icon nzType="close"></i>
				</ng-template>
			</div>

			<!-- Actions -->
			<div class="flex justify-end gap-3 mt-6 pt-4 border-t">
				<button nz-button type="button" (click)="ajusteForm.reset()">
					<i nz-icon nzType="close" nzTheme="outline"></i>
					Cancelar
				</button>
				<button nz-button nzType="primary" type="submit" [disabled]="ajusteForm.invalid">
					<i nz-icon nzType="save" nzTheme="outline"></i>
					Guardar Ajuste
				</button>
			</div>
		</form>
	</div>
</div>
